<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Trove Space LLC – Co-Living</title>
<meta name="description" content="Trove Space LLC – Singapore co-living. Clean, modern rooms with transparent pricing and a welcoming community."/>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#ffffff;
    --text:#111111;
    --muted:#5d5d5d;
    --gold:#b0895b;          /* gold tone to match logo */
    --gold-2:#c39a6b;        /* lighter gold */
    --line:#e9e9e9;
    --card:#fafafa;
    --ok:#1f8f48;
    --bad:#ba2e2e;
  }
  *{box-sizing:border-box}
  html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,"Noto Sans","Apple Color Emoji","Segoe UI Emoji";line-height:1.45}
  a{color:var(--gold);text-decoration:none}
  a:hover{text-decoration:underline}
  .container{max-width:1100px;margin-inline:auto;padding:24px}
  header{
    position:sticky;top:0;z-index:10;background:rgba(255,255,255,.92);
    backdrop-filter:saturate(180%) blur(6px); border-bottom:1px solid var(--line)
  }
  .nav{display:flex;gap:18px;align-items:center;justify-content:space-between}
  .brand{display:flex;align-items:center;gap:12px}
  .brand img{height:44px;width:auto}
  .brand .name{font-weight:700;letter-spacing:.4px}
  .pillnav{display:flex;gap:8px;flex-wrap:wrap}
  .pillnav a{padding:9px 14px;border:1px solid var(--line);border-radius:999px;color:var(--text);text-decoration:none;font-weight:500}
  .pillnav a.active, .pillnav a:hover{border-color:var(--gold);color:#000}
  .hero{display:grid;gap:18px;padding-block:28px}
  .hero-card{
    background:linear-gradient(180deg,#fff, #fcf9f6);
    border:1px solid var(--line); border-radius:18px; padding:26px;
    display:grid; gap:10px
  }
  .hero h1{margin:0;font-size:clamp(24px,4vw,36px)}
  .muted{color:var(--muted)}
  .cta{display:flex;gap:12px;flex-wrap:wrap;margin-top:6px}
  .btn{appearance:none;border:1px solid var(--gold);background:var(--gold);color:#fff;padding:10px 14px;border-radius:12px;font-weight:600;cursor:pointer}
  .btn.secondary{background:#fff;color:var(--gold)}
  .grid{display:grid;gap:16px}
  @media(min-width:860px){ .grid.cols-3{grid-template-columns:repeat(3,1fr)} .hero{grid-template-columns:1.2fr .8fr;align-items:center}}
  .card{
    background:var(--card);border:1px solid var(--line);border-radius:16px;overflow:hidden;display:flex;flex-direction:column
  }
  .card img{width:100%;height:180px;object-fit:cover}
  .card .pad{padding:14px}
  .tag{display:inline-block;padding:4px 8px;border-radius:999px;background:#fff;border:1px solid var(--line);font-size:12px;margin-right:6px}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .spacer{height:18px}
  footer{border-top:1px solid var(--line);padding:26px 0;margin-top:24px}
  /* Admin */
  .admin-wrap{display:grid;gap:16px}
  .login{max-width:460px;margin:auto;background:var(--card);border:1px solid var(--line);padding:22px;border-radius:14px}
  .field{display:grid;gap:6px;margin-bottom:12px}
  input,select,textarea{width:100%;padding:10px;border:1px solid var(--line);border-radius:10px;background:#fff}
  table{width:100%;border-collapse:collapse}
  th,td{padding:10px;border-bottom:1px solid var(--line);text-align:left;font-size:14px}
  .toolbar{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between}
  .tabs{display:flex;gap:8px;flex-wrap:wrap}
  .tabs button{padding:9px 12px;border:1px solid var(--line);background:#fff;border-radius:10px;cursor:pointer;font-weight:600}
  .tabs button.active{border-color:var(--gold);color:#000}
  .chip{font-size:12px;padding:4px 8px;border-radius:999px;border:1px solid var(--line);background:#fff}
  .status-ok{color:var(--ok);font-weight:700}
  .status-bad{color:var(--bad);font-weight:700}
  .note{font-size:12px;color:var(--muted)}
  .kbd{font:12px/1.2 ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New";background:#f4f4f4;border:1px solid var(--line);padding:2px 6px;border-radius:6px}
  .hidden{display:none !important}
</style>
</head>
<body>

<header>
  <div class="container nav">
    <div class="brand">
      <!-- Replace with your logo path -->
      <img src="./assets/logo.png" alt="Trove Space logo" />
      <div>
        <div class="name">Trove Space LLC</div>
        <div class="muted" style="font-size:12px;margin-top:2px">All Living Matters</div>
      </div>
    </div>
    <nav class="pillnav">
      <a href="#home" class="active">Home</a>
      <a href="#about">About</a>
      <a href="#listings">Listings</a>
      <a href="#admin">Admin</a>
    </nav>
  </div>
</header>

<main class="container">
  <!-- HOME -->
  <section id="home" class="route">
    <div class="hero">
      <div class="hero-card">
        <h1>Modern co-living in Singapore — simple, warm, and transparent.</h1>
        <p class="muted">All rooms include air-conditioning, high-speed Wi-Fi, and access to vibrant common areas — at honest, all-inclusive prices. No surprises.</p>
        <div class="cta">
          <a class="btn" href="#listings">See Available Rooms</a>
          <a class="btn secondary" href="https://wa.me/6590000000?text=Hi%20Trove%20Space%20—%20I%27m%20interested%20in%20co-living%20rooms." target="_blank" rel="noopener">WhatsApp Us</a>
        </div>
        <div class="spacer"></div>
        <div class="row">
          <span class="chip">30+ rooms</span>
          <span class="chip">Responsive support</span>
          <span class="chip">Great reviews</span>
        </div>
      </div>
      <div class="card">
        <img alt="Co-living lifestyle" src="assets/feature-co-living-hong-kong.jpeg" />
        <div class="pad">
          <div class="muted">“Feels like home — super clean and easy communication.”</div>
        </div>
      </div>
    </div>
  </section>

  <!-- ABOUT -->
  <section id="about" class="route hidden">
    <div class="grid" style="grid-template-columns:1fr;">
      <div class="card">
        <div class="pad">
          <h2>About Trove Space LLC</h2>
          <p>Founded in 2022, Trove Space LLC has quickly established itself as a leading co-living provider in Singapore, offering over 30 thoughtfully designed rooms that combine comfort and convenience.</p>
          <p>All our rooms include essentials — air-conditioning, high-speed Wi-Fi, and access to welcoming common areas — at transparent, all-inclusive prices. No hidden fees.</p>
          <ul>
            <li>Newly furnished rooms blending style and comfort</li>
            <li>Sincere, friendly service with high cleanliness standards</li>
            <li>Supportive community vibe with responsive WhatsApp communication</li>
            <li>Consistently positive Google reviews</li>
          </ul>
          <p>At Trove Space LLC, we don’t just provide rooms — we provide a home.</p>
          <div class="note">Powered bY Team Mindlink @2025.</div>
        </div>
      </div>
    </div>
  </section>

  <!-- LISTINGS -->
  <section id="listings" class="route hidden">
    <h2>Available Rooms</h2>
    <div id="listingGrid" class="grid cols-3"></div>
  </section>

  <!-- ADMIN -->
  <section id="admin" class="route hidden">
    <div id="adminGate"></div>
    <div id="adminApp" class="admin-wrap hidden">
      <div class="toolbar">
        <div class="tabs" id="adminTabs"></div>
        <div>
          <span class="note" id="userBadge"></span>
          <button class="btn secondary" id="exportBtn" title="Download a JSON backup">Export</button>
          <label for="importFile" class="btn secondary" style="cursor:pointer">Import</label>
          <input id="importFile" type="file" accept="application/json" class="hidden" />
          <button class="btn" id="logoutBtn">Logout</button>
        </div>
      </div>

      <!-- Panels -->
      <div id="panel-tenants" class="panel"></div>
      <div id="panel-owners" class="panel hidden"></div>
      <div id="panel-services" class="panel hidden"></div>
      <div id="panel-finance" class="panel hidden"></div>
      <div id="panel-files" class="panel hidden"></div>
      <div id="panel-users" class="panel hidden"></div>
      <div id="panel-activity" class="panel hidden"></div>
    </div>
  </section>
</main>

<footer>
  <div class="container">
    <div class="row" style="justify-content:space-between">
      <div>© <span id="yr"></span> Trove Space LLC. All rights reserved.</div>
      <div class="muted">A Place where Everyone call it HOME!</div>
    </div>
  </div>
</footer>

<script>
/* ---------- Mini “database” (localStorage) ---------- */
const STORAGE_KEY = "trovespace_db_v1";
const defaultDB = {
  listings: [
    {
      id:"casa-merah-1",
      title:"Casa Merah – Cozy Room near Tanah Merah MRT",
      link:"https://www.propertyguru.com.sg/project/casa-merah-743",
      img:"https://images.unsplash.com/photo-1505691938895-1758d7feb511?q=80&w=1600&auto=format&fit=crop",
      amenities:["AC","High-speed Wi-Fi","Furnished","Washer/Dryer","Common Lounge"],
      available:"2025-09-01",
      price:"From $1,450/mo",
      wa:"+6590000000"
    },
    {
      id:"optima-1",
      title:"Optima @ Tanah Merah – Bright Room with Pool Access",
      link:"https://www.propertyguru.com.sg/project/optima-tanah-merah-1559",
      img:"https://images.unsplash.com/photo-1524758631624-e2822e304c36?q=80&w=1600&auto=format&fit=crop",
      amenities:["AC","Wi-Fi","Study Desk","Kitchen Access","Gym/Pool"],
      available:"2025-09-05",
      price:"From $1,600/mo",
      wa:"+6590000000"
    },
    {
      id:"waterfront-key-1",
      title:"Waterfront Key – Serene Room by Bedok Reservoir",
      link:"https://www.propertyguru.com.sg/project/waterfront-key-1597",
      img:"https://images.unsplash.com/photo-1616594039964-ae9021a400a0?q=80&w=1600&auto=format&fit=crop",
      amenities:["AC","Wi-Fi","Lakeside Trails","Furnished","Weekly Cleaning"],
      available:"2025-09-12",
      price:"From $1,550/mo",
      wa:"+6590000000"
    }
  ],
  tenants:[
    {id:"T-1001",name:"Alex Tan",room:"Casa Merah #07-12",start:"2025-09-10",end:"2026-09-09",status:"Active",notes:"Paid deposit"},
  ],
  owners:[
    {id:"O-201",name:"Mr Lim",property:"Casa Merah 2BR",contract:"2025-08-01 to 2026-07-31",terms:"Revenue share 75/25"}
  ],
  services:[
    {id:"S-301",date:"2025-08-12",type:"Cleaning",property:"Optima",notes:"Deep clean before move-in"}
  ],
  finance:[
    {id:"F-401",date:"2025-08-01",type:"Rent In",amount:1450,party:"Alex Tan",ref:"INV-10001"},
    {id:"F-402",date:"2025-08-03",type:"Expense",amount:-120,party:"Cleaning Co",ref:"EXP-22001"}
  ],
  files:[
    {id:"file-1",name:"Sample Tenancy.pdf",url:"#",note:"Upload real docs later"}
  ],
  users:[
    // 6 demo accounts (plain-text for demo ONLY)
    {id:"admin01",name:"Chow",role:"admin",pass:"gold-888"},
    {id:"admin02",name:"Yong",role:"admin",pass:"gold-889"},
    {id:"staff01",name:"Bee",role:"staff",pass:"room-101"},
    {id:"staff02",name:"May",role:"staff",pass:"room-102"},
    {id:"staff03",name:"Ken",role:"staff",pass:"room-103"},
    {id:"viewer01",name:"Ops",role:"staff",pass:"view-000"}
  ],
  activity:[]
};

function loadDB(){
  try{
    return JSON.parse(localStorage.getItem(STORAGE_KEY)) || structuredClone(defaultDB);
  }catch(e){ return structuredClone(defaultDB); }
}
function saveDB(db){ localStorage.setItem(STORAGE_KEY, JSON.stringify(db)); }
let DB = loadDB();

function logActivity(actor, action, payload=""){
  const row = {ts:new Date().toISOString(), actor, action, payload};
  DB.activity.unshift(row);
  saveDB(DB);
}

/* ---------- Router (hash) ---------- */
const routes = ["home","about","listings","admin"];
function setActiveNav(hash){
  document.querySelectorAll('.pillnav a').forEach(a=>{
    a.classList.toggle('active', a.getAttribute('href')==="#"+hash);
  });
}
function showRoute(hash){
  if(!routes.includes(hash)) hash="home";
  document.querySelectorAll('.route').forEach(s=>s.classList.add('hidden'));
  document.getElementById(hash).classList.remove('hidden');
  setActiveNav(hash);
  if(hash==="listings") renderListings();
  if(hash==="admin") renderAdminGate();
}
window.addEventListener('hashchange', ()=>showRoute(location.hash.slice(1)));
showRoute(location.hash.slice(1)||"home");

/* ---------- Listings ---------- */
function waLink(num, title){
  const msg = encodeURIComponent(`Hi Trove Space — I'm interested in ${title}. Is it available?`);
  return `https://wa.me/${num.replace(/\D/g,'')}?text=${msg}`;
}
function renderListings(){
  const grid = document.getElementById('listingGrid');
  grid.innerHTML = "";
  DB.listings.forEach(item=>{
    const card = document.createElement('div');
    card.className="card";
    card.innerHTML = `
      <img alt="${item.title}" src="${item.img}">
      <div class="pad">
        <div class="row" style="justify-content:space-between">
          <h3 style="margin:0;font-size:18px">${item.title}</h3>
          <span class="tag">${item.price}</span>
        </div>
        <div class="muted" style="margin-top:6px">Available: ${item.available}</div>
        <div class="row" style="margin:8px 0 12px 0">${item.amenities.map(a=>`<span class="tag">${a}</span>`).join("")}</div>
        <div class="row">
          <a class="btn" target="_blank" rel="noopener" href="${waLink(item.wa,item.title)}">WhatsApp</a>
          <a class="btn secondary" target="_blank" rel="noopener" href="${item.link}">Project Info</a>
        </div>
      </div>`;
    grid.appendChild(card);
  });
}

/* ---------- Admin (Auth + Panels) ---------- */
const adminGate = document.getElementById('adminGate');
const adminApp  = document.getElementById('adminApp');
const userBadge = document.getElementById('userBadge');
let currentUser = null;

function renderAdminGate(){
  if(currentUser){ adminGate.classList.add('hidden'); adminApp.classList.remove('hidden'); buildAdminUI(); return; }
  adminApp.classList.add('hidden');
  adminGate.classList.remove('hidden');
  adminGate.innerHTML = `
    <div class="login">
      <h3 style="margin-top:0">Admin Login</h3>
      <div class="field">
        <label>User ID</label>
        <input id="loginId" placeholder="e.g. admin01" autocomplete="username">
      </div>
      <div class="field">
        <label>Password</label>
        <input id="loginPw" type="password" placeholder="••••••••" autocomplete="current-password">
      </div>
      <button class="btn" id="loginBtn">Login</button>
      <p class="note" style="margin-top:10px">Demo accounts: admin01/gold-888, admin02/gold-889, staff01/room-101, staff02/room-102, staff03/room-103, viewer01/view-000</p>
    </div>`;
  document.getElementById('loginBtn').onclick = ()=>{
    const id = document.getElementById('loginId').value.trim();
    const pw = document.getElementById('loginPw').value;
    const u = DB.users.find(u=>u.id===id && u.pass===pw);
    if(!u){ alert("Invalid credentials"); return; }
    currentUser = {id:u.id,name:u.name,role:u.role};
    userBadge.textContent = `Logged in as ${u.name} (${u.role})`;
    logActivity(u.id,"login");
    renderAdminGate();
  };
}

document.getElementById('logoutBtn').onclick = ()=>{
  if(currentUser){ logActivity(currentUser.id,"logout"); }
  currentUser=null; renderAdminGate();
};

document.getElementById('exportBtn').onclick = ()=>{
  const blob = new Blob([JSON.stringify(DB,null,2)],{type:"application/json"});
  const a = Object.assign(document.createElement('a'), {href:URL.createObjectURL(blob), download:"trovespace-backup.json"});
  document.body.appendChild(a); a.click(); a.remove();
};

document.getElementById('importFile').onchange = (e)=>{
  const f = e.target.files[0]; if(!f) return;
  const reader = new FileReader();
  reader.onload = ()=>{ try{ DB = JSON.parse(reader.result); saveDB(DB); alert("Imported!"); buildAdminUI(); }catch(err){ alert("Invalid JSON"); } };
  reader.readAsText(f);
};

/* Tabs */
const tabs = [
  {key:"tenants", label:"Tenants", adminOnly:false},
  {key:"owners",  label:"Owner Contracts", adminOnly:false},
  {key:"services",label:"Service Records", adminOnly:false},
  {key:"finance", label:"Finance", adminOnly:false},
  {key:"files",   label:"Files", adminOnly:false},
  {key:"users",   label:"Users", adminOnly:true},
  {key:"activity",label:"Activity Log", adminOnly:true},
];

function buildAdminUI(){
  // Build tabs
  const t = document.getElementById('adminTabs');
  t.innerHTML = "";
  tabs.forEach(tab=>{
    if(tab.adminOnly && currentUser.role!=="admin") return;
    const b = document.createElement('button'); b.textContent = tab.label; b.dataset.key=tab.key;
    b.onclick=()=>switchPanel(tab.key);
    t.appendChild(b);
  });
  switchPanel((currentUser.role==="admin")?"tenants":"tenants");
}

function switchPanel(key){
  document.querySelectorAll('.panel').forEach(p=>p.classList.add('hidden'));
  tabs.forEach(tb=>{
    const btn = Array.from(document.querySelectorAll('#adminTabs button')).find(x=>x.dataset.key===tb.key);
    if(btn) btn.classList.toggle('active', tb.key===key);
  });
  const m = {
    tenants: renderTenants,
    owners: renderOwners,
    services: renderServices,
    finance: renderFinance,
    files: renderFiles,
    users: renderUsers,
    activity: renderActivity
  };
  const target = document.getElementById('panel-'+key);
  target.classList.remove('hidden');
  m[key](target);
}

/* Helpers */
function makeAddRowForm(fields, onSubmit, submitText="Add"){
  const wrap = document.createElement('div');
  wrap.className="card"; wrap.style.margin="8px 0 14px 0";
  const inner = document.createElement('div'); inner.className="pad";
  inner.innerHTML = `<div class="row" style="gap:8px;align-items:end;flex-wrap:wrap"></div>`;
  const row = inner.querySelector('.row');
  const inputs = {};
  fields.forEach(f=>{
    const box = document.createElement('div'); box.style.minWidth="170px";
    box.className="field"; box.innerHTML = `<label>${f.label}</label><input ${f.type==="number"?"type=number":""} placeholder="${f.placeholder||""}" />`;
    const input = box.querySelector('input'); inputs[f.name]=input;
    row.appendChild(box);
  });
  const add = document.createElement('button'); add.className="btn"; add.textContent=submitText;
  add.onclick = ()=>{ const data = {}; fields.forEach(f=>data[f.name]=inputs[f.name].value); onSubmit(data); };
  inner.appendChild(add); wrap.appendChild(inner); return wrap;
}
function currency(n){ const x = Number(n); return (x<0?"-":"") + "$" + Math.abs(x).toFixed(2); }

/* Panels */
function renderTenants(node){
  node.innerHTML="";
  node.appendChild(makeAddRowForm(
    [
      {name:"id",label:"Tenant ID",placeholder:"T-1002"},
      {name:"name",label:"Name",placeholder:"Full name"},
      {name:"room",label:"Room",placeholder:"Waterfront Key #10-05"},
      {name:"start",label:"Start",placeholder:"YYYY-MM-DD"},
      {name:"end",label:"End",placeholder:"YYYY-MM-DD"}
    ],
    (d)=>{ DB.tenants.push({...d,status:"Active",notes:""}); saveDB(DB); logActivity(currentUser.id,"tenant:add",d.id); renderTenants(node); }
  ));
  const tbl = document.createElement('table');
  tbl.innerHTML = `<thead><tr><th>ID</th><th>Name</th><th>Room</th><th>Start</th><th>End</th><th>Status</th><th></th></tr></thead><tbody></tbody>`;
  const body = tbl.querySelector('tbody');
  DB.tenants.forEach((r,i)=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${r.id}</td><td>${r.name}</td><td>${r.room}</td><td>${r.start}</td><td>${r.end}</td><td>${r.status}</td>
                    <td><button class="btn secondary" data-i="${i}">End</button> <button class="btn secondary" data-d="${i}">Del</button></td>`;
    body.appendChild(tr);
  });
  body.querySelectorAll('button[data-i]').forEach(b=>b.onclick=()=>{ const i=b.dataset.i; DB.tenants[i].status="Ended"; saveDB(DB); logActivity(currentUser.id,"tenant:end",DB.tenants[i].id); renderTenants(node);});
  body.querySelectorAll('button[data-d]').forEach(b=>b.onclick=()=>{ const i=b.dataset.d; if(confirm("Delete tenant?")){ logActivity(currentUser.id,"tenant:del",DB.tenants[i].id); DB.tenants.splice(i,1); saveDB(DB); renderTenants(node);} });
  node.appendChild(tbl);
}

function renderOwners(node){
  node.innerHTML="";
  node.appendChild(makeAddRowForm(
    [
      {name:"id",label:"Owner ID",placeholder:"O-202"},
      {name:"name",label:"Name",placeholder:"Owner name"},
      {name:"property",label:"Property",placeholder:"Optima 2BR"},
      {name:"contract",label:"Contract",placeholder:"2025-08-01 to 2026-07-31"},
      {name:"terms",label:"Terms",placeholder:"Revenue share"}
    ],
    (d)=>{ DB.owners.push(d); saveDB(DB); logActivity(currentUser.id,"owner:add",d.id); renderOwners(node); }
  ));
  const tbl = document.createElement('table');
  tbl.innerHTML = `<thead><tr><th>ID</th><th>Name</th><th>Property</th><th>Contract</th><th>Terms</th><th></th></tr></thead><tbody></tbody>`;
  const body = tbl.querySelector('tbody');
  DB.owners.forEach((r,i)=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${r.id}</td><td>${r.name}</td><td>${r.property}</td><td>${r.contract}</td><td>${r.terms}</td>
                    <td><button class="btn secondary" data-d="${i}">Del</button></td>`;
    body.appendChild(tr);
  });
  body.querySelectorAll('button[data-d]').forEach(b=>b.onclick=()=>{ const i=b.dataset.d; if(confirm("Delete owner?")){ logActivity(currentUser.id,"owner:del",DB.owners[i].id); DB.owners.splice(i,1); saveDB(DB); renderOwners(node);} });
  node.appendChild(tbl);
}

function renderServices(node){
  node.innerHTML="";
  node.appendChild(makeAddRowForm(
    [
      {name:"id",label:"Record ID",placeholder:"S-302"},
      {name:"date",label:"Date",placeholder:"YYYY-MM-DD"},
      {name:"type",label:"Type",placeholder:"Cleaning / Repair"},
      {name:"property",label:"Property",placeholder:"Casa Merah"},
      {name:"notes",label:"Notes",placeholder:"Details"}
    ],
    (d)=>{ DB.services.push(d); saveDB(DB); logActivity(currentUser.id,"service:add",d.id); renderServices(node); }
  ));
  const tbl = document.createElement('table');
  tbl.innerHTML = `<thead><tr><th>ID</th><th>Date</th><th>Type</th><th>Property</th><th>Notes</th><th></th></tr></thead><tbody></tbody>`;
  const body = tbl.querySelector('tbody');
  DB.services.forEach((r,i)=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${r.id}</td><td>${r.date}</td><td>${r.type}</td><td>${r.property}</td><td>${r.notes}</td>
                    <td><button class="btn secondary" data-d="${i}">Del</button></td>`;
    body.appendChild(tr);
  });
  body.querySelectorAll('button[data-d]').forEach(b=>b.onclick=()=>{ const i=b.dataset.d; if(confirm("Delete record?")){ logActivity(currentUser.id,"service:del",DB.services[i].id); DB.services.splice(i,1); saveDB(DB); renderServices(node);} });
  node.appendChild(tbl);
}

function renderFinance(node){
  node.innerHTML="";
  node.appendChild(makeAddRowForm(
    [
      {name:"id",label:"Txn ID",placeholder:"F-403"},
      {name:"date",label:"Date",placeholder:"YYYY-MM-DD"},
      {name:"type",label:"Type",placeholder:"Rent In / Expense"},
      {name:"amount",label:"Amount",placeholder:"e.g. 1450"},
      {name:"party",label:"Party",placeholder:"Payer/Payee"},
      {name:"ref",label:"Ref",placeholder:"Invoice/Exp Ref"}
    ],
    (d)=>{ d.amount=Number(d.amount||0); DB.finance.push(d); saveDB(DB); logActivity(currentUser.id,"finance:add",d.id); renderFinance(node); }
  ));
  const sum = DB.finance.reduce((a,b)=>a + Number(b.amount||0),0);
  node.insertAdjacentHTML("beforeend", `<div class="chip">Balance: <strong style="margin-left:6px">${currency(sum)}</strong></div>`);
  const tbl = document.createElement('table');
  tbl.innerHTML = `<thead><tr><th>ID</th><th>Date</th><th>Type</th><th>Amount</th><th>Party</th><th>Ref</th><th></th></tr></thead><tbody></tbody>`;
  const body = tbl.querySelector('tbody');
  DB.finance.forEach((r,i)=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${r.id}</td><td>${r.date}</td><td>${r.type}</td><td>${currency(r.amount)}</td><td>${r.party}</td><td>${r.ref}</td>
                    <td><button class="btn secondary" data-d="${i}">Del</button></td>`;
    body.appendChild(tr);
  });
  body.querySelectorAll('button[data-d]').forEach(b=>b.onclick=()=>{ const i=b.dataset.d; if(confirm("Delete transaction?")){ logActivity(currentUser.id,"finance:del",DB.finance[i].id); DB.finance.splice(i,1); saveDB(DB); renderFinance(node);} });
  node.appendChild(tbl);
}

function renderFiles(node){
  node.innerHTML="";
  // Note: For security, actual file uploads need a backend. Here we store metadata only.
  node.appendChild(makeAddRowForm(
    [
      {name:"id",label:"File ID",placeholder:"file-2"},
      {name:"name",label:"Display Name",placeholder:"Owner-Contract.pdf"},
      {name:"url",label:"URL (GitHub/Drive link)",placeholder:"https://..."},
      {name:"note",label:"Note",placeholder:"Agreement v1"}
    ],
    (d)=>{ DB.files.push(d); saveDB(DB); logActivity(currentUser.id,"files:add",d.id); renderFiles(node); },
    "Add Link"
  ));
  const tbl = document.createElement('table');
  tbl.innerHTML = `<thead><tr><th>ID</th><th>Name</th><th>Link</th><th>Note</th><th></th></tr></thead><tbody></tbody>`;
  const body = tbl.querySelector('tbody');
  DB.files.forEach((r,i)=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${r.id}</td><td>${r.name}</td><td><a target="_blank" href="${r.url}">Open</a></td><td>${r.note||""}</td>
                    <td><button class="btn secondary" data-d="${i}">Del</button></td>`;
    body.appendChild(tr);
  });
  body.querySelectorAll('button[data-d]').forEach(b=>b.onclick=()=>{ const i=b.dataset.d; if(confirm("Delete file ref?")){ logActivity(currentUser.id,"files:del",DB.files[i].id); DB.files.splice(i,1); saveDB(DB); renderFiles(node);} });
  node.appendChild(tbl);
}

function renderUsers(node){
  if(currentUser.role!=="admin"){ node.innerHTML="<p>Admins only.</p>"; return; }
  node.innerHTML="";
  node.appendChild(makeAddRowForm(
    [
      {name:"id",label:"User ID",placeholder:"staff04"},
      {name:"name",label:"Name",placeholder:"Full name"},
      {name:"role",label:"Role (admin/staff)",placeholder:"staff"},
      {name:"pass",label:"Password",placeholder:"set a password"}
    ],
    (d)=>{ DB.users.push(d); saveDB(DB); logActivity(currentUser.id,"user:add",d.id); renderUsers(node); }
  ));
  const tbl = document.createElement('table');
  tbl.innerHTML = `<thead><tr><th>User</th><th>Name</th><th>Role</th><th></th></tr></thead><tbody></tbody>`;
  const body = tbl.querySelector('tbody');
  DB.users.forEach((r,i)=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${r.id}</td><td>${r.name}</td><td>${r.role}</td>
                    <td>${r.role==="admin" && DB.users.filter(u=>u.role==="admin").length===1 ? "<span class='note'>last admin</span>": `<button class="btn secondary" data-d="${i}">Del</button>`}</td>`;
    body.appendChild(tr);
  });
  body.querySelectorAll('button[data-d]').forEach(b=>b.onclick=()=>{ const i=b.dataset.d;
    if(confirm("Delete user?")){ logActivity(currentUser.id,"user:del",DB.users[i].id); DB.users.splice(i,1); saveDB(DB); renderUsers(node); }
  });
  node.appendChild(tbl);
}

function renderActivity(node){
  const tbl = document.createElement('table');
  tbl.innerHTML = `<thead><tr><th>When</th><th>User</th><th>Action</th><th>Payload</th></tr></thead><tbody></tbody>`;
  const body = tbl.querySelector('tbody');
  DB.activity.forEach(r=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${new Date(r.ts).toLocaleString()}</td><td>${r.actor}</td><td>${r.action}</td><td>${r.payload}</td>`;
    body.appendChild(tr);
  });
  node.innerHTML="";
  node.appendChild(tbl);
}

/* Init */
document.getElementById('yr').textContent = new Date().getFullYear();
</script>
</body>
</html>
